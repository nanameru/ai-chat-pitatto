# Deep Research Agent 設計ドキュメント

## 1. 概念図の詳細分析

添付された概念図は、高度な研究・文書作成プロセスを表しており、「Planning / Structure」と「Research」という2つの主要セクションに分かれています。

### 1.1 全体構造

概念図は研究プロセスの2つの主要コンポーネントを示しています：
1. **左側**: 計画と文書構造の設計
2. **右側**: 反復的な検索と情報収集プロセス

### 1.2 Planning / Structure セクション

このセクションは文書作成の計画フェーズを表しています：

#### 1.2.1 入力要素
- **Topic (トピック)**: 研究または文書の主題
- **Outline (アウトライン)**: 文書の基本構造

#### 1.2.2 処理
- **AI/LLMモデル**: 脳のアイコンで表される処理ユニット
  - トピックとアウトラインを入力として受け取る
  - セクション構造を生成する
  - ユーザーフィードバックに基づいて計画を反復的に改善する

#### 1.2.3 出力
- **Section構造**: 
  - Intro (導入)
  - Section 1 (セクション1)
  - Section 2 (セクション2)
  - Conclusion (結論)

#### 1.2.4 ユーザー制御ポイント
- **アウトラインの提供**: ユーザーが初期アウトラインを提供
- **プランナーモデルの指定**: ユーザーがAIモデル（o3, DeepSeekなど）を選択
- **計画のレビューとフィードバック**: ユーザーが計画を評価し、改善のためのフィードバックを提供

### 1.3 Research セクション

このセクションは反復的な検索と情報収集プロセスを表しています：

#### 1.3.1 検索サイクルの構成要素
- **Search Query (検索クエリ)**: AIが生成する検索クエリ
- **Web Search (ウェブ検索)**: 検索エンジンによる情報収集
- **Accumulated Research (蓄積された研究)**: 収集された情報の保存場所
- **Reflection (振り返り)**: 収集された情報の分析と次のクエリ決定

#### 1.3.2 検索サイクルのフロー
1. AIが検索クエリを生成
2. 生成されたクエリでウェブ検索を実行
3. 検索結果が蓄積された研究に追加
4. AIが結果を分析し、情報の不足を特定
5. 新しい検索クエリを生成して次の検索を実行
6. 十分な情報が収集されるまで、または指定された反復回数に達するまでサイクルを繰り返す

#### 1.3.3 ユーザー制御ポイント
- **検索クエリ数の指定**: 各セクションに対して実行する検索の数
- **検索APIの指定**: 使用する検索エンジンやAPIの選択
- **検索反復回数の指定**: 検索サイクルを繰り返す最大回数

### 1.4 セクション間の連携

- 計画フェーズで作成された各セクションが、個別の検索プロセスにつながっている
- 各セクションの特性に基づいて、特化した検索クエリが生成される
- 検索結果は、対応するセクションの内容を強化するために使用される

## 2. Deep Research Agent 実装計画

### 2.1 アーキテクチャ概要

```
DeepResearchAgent/
├── planningAgent/
│   ├── outlineGenerator.ts
│   ├── sectionPlanner.ts
│   └── planReviewer.ts
├── researchAgent/
│   ├── queryGenerator.ts
│   ├── searchExecutor.ts
│   ├── resultAnalyzer.ts
│   └── informationAccumulator.ts
├── integrationAgent/
│   ├── sectionContentGenerator.ts
│   └── documentAssembler.ts
└── main.ts
```

### 2.2 コンポーネント詳細

#### 2.2.1 Planning Agent

**目的**: トピックとアウトラインから文書構造を計画

**主要コンポーネント**:
- **outlineGenerator**: ユーザー入力からアウトラインを生成または拡張
- **sectionPlanner**: アウトラインを基にセクション構造を作成
- **planReviewer**: 計画のレビューとフィードバックの処理

**入力**:
- トピック
- 初期アウトライン（オプション）
- プランナーモデルの指定

**出力**:
- 詳細なセクション構造
- 各セクションの目的と焦点

**実装例**:
```typescript
export const planningAgent = new Agent({
  name: "Planning Agent",
  instructions: `
    あなたは文書計画の専門家です。
    トピックとアウトラインを分析し、効果的な文書構造を計画してください。
    各セクションの目的と焦点を明確に定義してください。
  `,
  model: openai("gpt-4o"),
  tools: {
    outlineGenerator,
    sectionPlanner,
    planReviewer,
  },
});
```

#### 2.2.2 Research Agent

**目的**: セクションごとに特化した検索と情報収集を実行

**主要コンポーネント**:
- **queryGenerator**: セクションの焦点に基づいて検索クエリを生成
- **searchExecutor**: 検索APIを使用して情報を収集
- **resultAnalyzer**: 検索結果を分析し、情報の不足を特定
- **informationAccumulator**: 収集された情報を蓄積・整理

**入力**:
- セクション情報（タイトル、目的、焦点）
- 検索API設定
- 検索反復回数の設定

**出力**:
- セクションごとの収集情報
- 情報の信頼性と関連性の評価

**実装例**:
```typescript
export const researchAgent = new Agent({
  name: "Research Agent",
  instructions: `
    あなたは情報収集の専門家です。
    セクションの焦点に基づいて効果的な検索クエリを生成し、
    情報を収集・分析してください。
    情報の不足を特定し、追加の検索を行ってください。
  `,
  model: openai("gpt-4o"),
  tools: {
    queryGenerator,
    searchTool,
    analysisTool,
    informationAccumulator,
  },
});
```

#### 2.2.3 Integration Agent

**目的**: 収集された情報を統合して文書を生成

**主要コンポーネント**:
- **sectionContentGenerator**: 収集情報からセクション内容を生成
- **documentAssembler**: 各セクションを統合して完全な文書を作成

**入力**:
- セクション構造
- セクションごとの収集情報

**出力**:
- 完成した文書

**実装例**:
```typescript
export const integrationAgent = new Agent({
  name: "Integration Agent",
  instructions: `
    あなたは情報統合の専門家です。
    収集された情報を分析し、一貫性のある文書を作成してください。
    各セクションの内容が全体の流れに貢献するようにしてください。
  `,
  model: openai("gpt-4o"),
  tools: {
    sectionContentGenerator,
    documentAssembler,
  },
});
```

### 2.3 ワークフロー

1. **計画フェーズ**:
   - ユーザーがトピックとアウトラインを提供
   - Planning Agentがセクション構造を生成
   - ユーザーが計画をレビューし、フィードバックを提供
   - 必要に応じて計画を反復的に改善

2. **研究フェーズ**:
   - 各セクションに対して:
     - Research Agentが検索クエリを生成
     - 検索を実行し、結果を収集
     - 結果を分析し、情報の不足を特定
     - 追加の検索クエリを生成
     - 指定された反復回数まで検索を繰り返す

3. **統合フェーズ**:
   - Integration Agentが各セクションの内容を生成
   - セクションを統合して完全な文書を作成
   - ユーザーに最終文書を提示

### 2.4 ユーザー制御インターフェース

#### 2.4.1 計画フェーズの制御
- トピックとアウトラインの入力フォーム
- プランナーモデルの選択オプション
- 計画レビューとフィードバックのインターフェース

#### 2.4.2 研究フェーズの制御
- 検索API選択
- セクションごとの検索クエリ数設定
- 検索反復回数の設定
- 検索進捗のリアルタイム表示

#### 2.4.3 統合フェーズの制御
- 文書形式の選択
- セクション内容の編集オプション
- 最終文書のエクスポート機能

## 3. 実装ロードマップ

### 3.1 フェーズ1: 基本構造の実装
- Planning Agentの基本機能実装
- Research Agentの基本検索機能実装
- 簡易的なユーザーインターフェース

### 3.2 フェーズ2: 高度な検索機能
- 検索クエリ生成の改善
- 検索結果分析の強化
- 情報蓄積システムの実装

### 3.3 フェーズ3: 統合と洗練
- Integration Agentの実装
- ユーザーインターフェースの改善
- 全体ワークフローの最適化

### 3.4 フェーズ4: 評価と改善
- ユーザーテスト
- パフォーマンス評価
- フィードバックに基づく改善

## 4. 技術的考慮事項

### 4.1 AIモデル選択
- 計画フェーズ: GPT-4o（複雑な構造理解に適している）
- 検索クエリ生成: GPT-4o-mini（高速で効率的）
- 内容生成: GPT-4o（高品質な文章生成）

### 4.2 検索API
- SerpAPI: 汎用的なウェブ検索
- 専門データベースAPI: 必要に応じて特定分野の情報収集

### 4.3 データ構造
- セクション情報: JSON形式で構造化
- 収集情報: ベクトルデータベースで効率的に保存・検索

### 4.4 パフォーマンス最適化
- 並列検索処理
- 増分的な情報蓄積
- キャッシュシステム

## 5. 今後の拡張可能性

### 5.1 マルチモーダル対応
- 画像検索と分析
- 動画コンテンツの活用

### 5.2 協調作業機能
- 複数ユーザーによる共同編集
- 専門家レビュー統合

### 5.3 自動更新システム
- 定期的な情報更新
- 最新研究の自動統合

## 6. まとめ

この設計ドキュメントは、概念図に基づいたDeep Research Agentの実装計画を詳細に説明しています。このエージェントは、計画、研究、統合の3つの主要フェーズを通じて、高品質な研究文書の作成を支援します。ユーザーは各フェーズでプロセスをコントロールでき、AIの能力を最大限に活用しながら、自分のニーズに合った文書を作成することができます。
