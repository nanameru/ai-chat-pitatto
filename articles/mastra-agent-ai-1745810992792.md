---
title: "Mastra Agent の基本：AI アシスタントを作ろう"
emoji: "🤖"
type: "article"
topics: ["Mastra", "Agent", "AI", "TypeScript", "LLM"]
published: false
---

---
title: "Mastra Agent の基本：AI アシスタントを作ろう"
emoji: "🤖"
type: "tech"
topics: ["Mastra", "Agent", "AI", "TypeScript", "LLM"]
published: false
---

# Mastra Agent の基本：AI アシスタントを作ろう

Mastra の中心的な機能の一つが **Agent** です。Agent を使うことで、特定の役割や能力を持った AI アシスタントを簡単に作成し、対話やタスク実行をさせることができます。

この記事では、Mastra Agent の基本となる `Agent` クラスの作成方法と、主要な設定項目について解説します。

> 公式ドキュメント: [Agent Overview](https://mastra.ai/ja/docs/concepts/agent)

---

## 1. Mastra Agent とは？

Mastra Agent は、大規模言語モデル（LLM）をベースに、特定の指示（Instructions）やツール（Tools）、記憶（Memory）などを組み合わせて作られる、自律的な AI エンティティです。

例えば、以下のような Agent を作ることができます。

*   天気予報を教えてくれる Agent
*   ユーザーの質問に答えるカスタマーサポート Agent
*   特定の Web API を叩いて情報を取得する Agent

---

## 2. Agent を作成する基本

Agent の作成は `Agent` クラスのインスタンス化によって行います。最低限必要なのは `name`, `instructions`, `model` の 3 つです。

```ts
import { Agent } from '@mastra/core/agent';
import { openai } from '@ai-sdk/openai'; // 使用する LLM プロバイダーをインポート

// シンプルな挨拶 Agent の作成
export const greetingAgent = new Agent({
  // 1. name: Agent を識別するための一意な名前
  name: 'greeting-agent',

  // 2. instructions: Agent に与える役割や行動指針 (システムプロンプト)
  instructions: 'あなたはフレンドリーな挨拶をするアシスタントです。ユーザーに元気よく挨拶してください。',

  // 3. model: 使用する言語モデルのインスタンス
  model: openai('gpt-4o-mini'), // OpenAI の gpt-4o-mini を使用
});
```

*   **`name`**: Agent をシステム内で一意に識別するための文字列です。ケバブケースなどが推奨されます。
*   **`instructions`**: Agent の基本的な振る舞いを定義する指示文です。これが LLM に渡されるシステムプロンプトのベースとなります。
*   **`model`**: Agent が思考や応答生成に利用する LLM を指定します。`@ai-sdk/openai` や `@ai-sdk/anthropic` など、サポートされているプロバイダーのモデルインスタンスを渡します。

---

## 3. Agent と対話する

作成した Agent とは、`.generate()` や `.stream()` メソッドを使って対話できます。

```ts
// Agent のインスタンスを取得 (例: 上記の greetingAgent)
import { greetingAgent } from './agents/greetingAgent';

async function talkToAgent() {
  const userInput = "こんにちは！";

  // テキスト応答を生成
  const response = await greetingAgent.generate(userInput);
  console.log("Agent:", response);
  // 例: "こんにちは！お元気ですか？何かお手伝いできることはありますか？"

  // ストリーミングで応答を取得
  const stream = await greetingAgent.stream(userInput);
  for await (const chunk of stream) {
    process.stdout.write(chunk); // チャンクを逐次表示
  }
  console.log();
}

talkToAgent();
```

---

## 4. Agent の機能を拡張する (オプション)

基本的な Agent に加え、以下のオプションで機能を拡張できます。

*   **`tools`**: Agent が利用できる外部ツール（関数）のセット。API 連携や特定の計算などが可能になります。(例: `tools: { getWeatherTool, searchWebTool }`)
*   **`memory`**: 会話履歴やコンテキストを保持・管理する機能。長期的な対話で文脈を維持します。(例: `memory: new Memory()`)
*   **`voice`**: 音声入出力機能を追加します。音声での対話が可能になります。(例: `voice: new OpenAIVoice()`)

```ts
import { Memory } from '@mastra/memory';
import { weatherTool } from './tools/weatherTool';

export const advancedAgent = new Agent({
  name: 'advanced-agent',
  instructions: 'あなたは天気情報を教え、会話を覚えているアシスタントです。',
  model: openai('gpt-4o-mini'),
  tools: { weatherTool }, // 天気ツールを利用可能に
  memory: new Memory({ // Memory機能を有効化
    semanticRecall: { enabled: true }
  }),
});
```

---

## 5. Agent を登録する

作成した Agent は、Mastra インスタンスに登録することで、API などから利用できるようになります。通常、`src/mastra/index.ts` (またはそれに類するファイル) で一元管理します。

```ts
// src/mastra/index.ts (例)
import { Mastra } from '@mastra/core';
import { greetingAgent } from './agents/greetingAgent';
import { advancedAgent } from './agents/advancedAgent';

export const mastra = new Mastra({
  // agents プロパティに作成した Agent インスタンスを登録
  agents: {
    greetingAgent,
    advancedAgent,
    // 他の Agent もここに追加
  },
  // workflows や tools も同様に登録可能
});
```
(参考: [Mastra プロジェクト構造ルール](https://gist.github.com/...) - プロジェクトに合わせて参照先を修正してください)

---

## まとめ

Mastra Agent は、`name`, `instructions`, `model` を指定するだけで簡単に作成できます。さらに `tools` や `memory` を追加することで、より高度で実用的な AI アシスタントへと拡張可能です。

まずはシンプルな Agent を作り、徐々に機能を追加していくのがおすすめです。
