<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ToT Research Architecture</title>
  <style>
    body { 
      font-family: 'Segoe UI', 'Meiryo UI', 'Hiragino Sans', sans-serif; 
      background: #fafbfc;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-weight: 600;
      color: #2c3e50;
      text-align: center;
      margin: 24px 0;
      font-size: 28px;
    }
    svg {
      display: block;
      margin: 0 auto;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }
    .node { 
      fill: url(#node-gradient); 
      stroke: #4a6baf; 
      stroke-width: 1.5; 
      rx: 8; 
      ry: 8;
    }
    .tool { 
      fill: url(#tool-gradient); 
      stroke: #d68c23; 
      stroke-width: 1.5; 
      rx: 8; 
      ry: 8;
    }
    .config { 
      fill: url(#config-gradient); 
      stroke: #2a9d8f; 
      stroke-width: 1.5; 
      rx: 8; 
      ry: 8;
    }
    .log { 
      fill: url(#log-gradient); 
      stroke: #8a4f9e; 
      stroke-width: 1.5; 
      rx: 8; 
      ry: 8;
    }
    .tree { 
      fill: url(#tree-gradient); 
      stroke: #0077b6; 
      stroke-width: 1.5; 
      rx: 8; 
      ry: 8;
    }
    .round-box {
      fill: url(#round-gradient);
      stroke: #e67e22;
      stroke-width: 1.5;
      rx: 8;
      ry: 8;
    }
    .arrow { 
      stroke: #566573; 
      stroke-width: 2; 
      marker-end: url(#arrowhead);
      stroke-dasharray: none;
      stroke-linecap: round;
    }
    .arrow-flow {
      stroke-dasharray: 5, 3;
    }
    text { 
      font-size: 14px; 
      fill: #2c3e50;
    }
    .label { 
      font-weight: bold; 
      font-size: 15px;
      fill: #1a365d;
    }
    .desc { 
      font-size: 12px; 
      fill: #34495e; 
    }
    .flow-label {
      font-size: 11px;
      fill: #566573;
      font-style: italic;
    }
    .legend-box {
      fill: white;
      stroke: #ddd;
      stroke-width: 1;
      rx: 6;
      ry: 6;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.05));
    }
    .legend-item {
      rx: 4;
      ry: 4;
    }
    .legend-text {
      font-size: 12px;
      fill: #34495e;
    }
    .user-icon {
      fill: white;
      stroke: #7f8c8d;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
    }
  </style>
</head>
<body>
<h1>Tree of Thoughts アーキテクチャ図</h1>
<svg width="980" height="540">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#566573"/>
    </marker>
    
    <!-- グラデーション定義 -->
    <linearGradient id="node-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#e8eeff" />
      <stop offset="100%" stop-color="#d4e0ff" />
    </linearGradient>
    
    <linearGradient id="tool-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#fff8e8" />
      <stop offset="100%" stop-color="#fff0d0" />
    </linearGradient>
    
    <linearGradient id="config-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#e8fff0" />
      <stop offset="100%" stop-color="#d0f5e6" />
    </linearGradient>
    
    <linearGradient id="log-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f8eeff" />
      <stop offset="100%" stop-color="#f0e0ff" />
    </linearGradient>
    
    <linearGradient id="tree-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#e8f7ff" />
      <stop offset="100%" stop-color="#d0f0ff" />
    </linearGradient>
    
    <linearGradient id="round-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#fff9e6" />
      <stop offset="100%" stop-color="#ffeecc" />
    </linearGradient>
    
    <!-- 影の定義 -->
    <filter id="drop-shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
      <feOffset dx="2" dy="2" result="offsetblur" />
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.2" />
      </feComponentTransfer>
      <feMerge>
        <feMergeNode />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>

  <!-- Agent -->
  <rect x="60" y="60" width="160" height="80" class="node" filter="url(#drop-shadow)"/>
  <text x="140" y="80" text-anchor="middle" class="label">totResearchAgent</text>
  <text x="140" y="100" text-anchor="middle" class="desc">ユーザー入力受信</text>
  <text x="140" y="118" text-anchor="middle" class="desc">クエリ解析 → 探索起動</text>

  <!-- Controller -->
  <rect x="280" y="60" width="180" height="80" class="node" filter="url(#drop-shadow)"/>
  <text x="370" y="80" text-anchor="middle" class="label">searchController.ts</text>
  <text x="370" y="100" text-anchor="middle" class="desc">BFS / Beam Search</text>
  <text x="370" y="118" text-anchor="middle" class="desc">探索アルゴリズム制御</text>
  <path d="M220,100 C240,100 260,100 280,100" class="arrow" fill="none"/>
  <text x="250" y="90" text-anchor="middle" class="flow-label">クエリ送信</text>

  <!-- Planner -->
  <rect x="540" y="60" width="140" height="80" class="node" filter="url(#drop-shadow)"/>
  <text x="610" y="80" text-anchor="middle" class="label">planner.ts</text>
  <text x="610" y="100" text-anchor="middle" class="desc">expand / evaluate</text>
  <text x="610" y="118" text-anchor="middle" class="desc">思考ノード生成・評価</text>
  <path d="M460,100 C480,100 520,100 540,100" class="arrow" fill="none"/>
  <text x="500" y="90" text-anchor="middle" class="flow-label">探索指示</text>

  <!-- State Tree -->
  <rect x="760" y="40" width="180" height="120" class="tree" filter="url(#drop-shadow)"/>
  <text x="850" y="65" text-anchor="middle" class="label">State Tree</text>
  <text x="850" y="85" text-anchor="middle" class="desc">探索思考ツリー</text>
  <text x="850" y="105" text-anchor="middle" class="desc">maxDepth, beamWidth 制御</text>
  <text x="850" y="125" text-anchor="middle" class="desc">枝刈りとメモ化機能</text>
  <text x="850" y="145" text-anchor="middle" class="desc">多次元スコア管理</text>
  <path d="M680,100 C700,100 740,100 760,100" class="arrow" fill="none"/>
  <text x="720" y="90" text-anchor="middle" class="flow-label">ノード生成</text>

  <!-- Tools -->
  <rect x="540" y="180" width="140" height="70" class="tool" filter="url(#drop-shadow)"/>
  <text x="610" y="200" text-anchor="middle" class="label">Thought Tools</text>
  <text x="610" y="220" text-anchor="middle" class="desc">Generator / Evaluator</text>
  <text x="610" y="238" text-anchor="middle" class="desc">LLM思考生成・評価</text>
  <path d="M610,140 C610,150 610,165 610,180" class="arrow" fill="none"/>
  <text x="640" y="160" text-anchor="middle" class="flow-label">モデル呼び出し</text>

  <!-- Config -->
  <rect x="60" y="180" width="160" height="70" class="config" filter="url(#drop-shadow)"/>
  <text x="140" y="200" text-anchor="middle" class="label">totConfig.ts</text>
  <text x="140" y="220" text-anchor="middle" class="desc">探索パラメータ管理</text>
  <text x="140" y="238" text-anchor="middle" class="desc">maxDepth, beamWidth, 閾値</text>
  <path d="M140,140 C140,150 140,165 140,180" class="arrow" fill="none"/>
  <text x="170" y="160" text-anchor="middle" class="flow-label">設定読み込み</text>

  <!-- Logging -->
  <rect x="280" y="180" width="180" height="70" class="log" filter="url(#drop-shadow)"/>
  <text x="370" y="200" text-anchor="middle" class="label">pino logger</text>
  <text x="370" y="220" text-anchor="middle" class="desc">構造化ログ記録</text>
  <text x="370" y="238" text-anchor="middle" class="desc">phase, tool, duration_ms, コスト</text>
  <path d="M370,140 C370,150 370,165 370,180" class="arrow" fill="none"/>
  <text x="400" y="160" text-anchor="middle" class="flow-label">実行状況記録</text>

  <!-- User -->
  <ellipse cx="30" cy="100" rx="18" ry="18" class="user-icon" filter="url(#drop-shadow)"/>
  <text x="30" y="105" text-anchor="middle" font-size="18">👤</text>
  <path d="M48,100 C52,100 56,100 60,100" class="arrow" fill="none"/>
  <text x="30" y="130" text-anchor="middle" class="flow-label">ユーザー</text>

  <!-- Round label -->
  <rect x="780" y="180" width="140" height="55" class="round-box" filter="url(#drop-shadow)"/>
  <text x="850" y="200" text-anchor="middle" class="label">探索ラウンド処理</text>
  <text x="850" y="218" text-anchor="middle" class="desc">思考生成 → 評価 → 選択</text>
  <text x="850" y="234" text-anchor="middle" class="desc">基づく次ノード展開</text>
  <path d="M840,160 C840,165 840,172 840,180" class="arrow" fill="none"/>
  <text x="870" y="170" text-anchor="middle" class="flow-label">ベストノード選択</text>

  <!-- Legend -->
  <rect x="700" y="400" width="260" height="90" class="legend-box"/>
  <text x="710" y="420" class="label">凡例：</text>
  <rect x="710" y="430" width="18" height="18" class="node legend-item"/>
  <text x="735" y="445" class="legend-text">主要モジュール</text>
  <rect x="710" y="455" width="18" height="18" class="tool legend-item"/>
  <text x="735" y="470" class="legend-text">ツール群</text>
  <rect x="820" y="430" width="18" height="18" class="config legend-item"/>
  <text x="845" y="445" class="legend-text">設定</text>
  <rect x="820" y="455" width="18" height="18" class="log legend-item"/>
  <text x="845" y="470" class="legend-text">ロギング</text>
  <rect x="910" y="430" width="18" height="18" class="tree legend-item"/>
  <text x="935" y="445" class="legend-text">探索ツリー</text>
</svg>
</body>
</html>
